!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.timelineModule=t():e.timelineModule=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.r(t),e.d(t,{Timeline:()=>we,TimelineCapShape:()=>te,TimelineClickEvent:()=>Z,TimelineCursorType:()=>ee,TimelineDragEvent:()=>oe,TimelineElementType:()=>$,TimelineEventSource:()=>g,TimelineEvents:()=>ie,TimelineEventsEmitter:()=>o,TimelineInteractionMode:()=>Q,TimelineKeyframeChangedEvent:()=>b,TimelineKeyframeShape:()=>i,TimelineScrollSource:()=>re,TimelineSelectedEvent:()=>j,TimelineSelectionMode:()=>ne,TimelineStyleUtils:()=>l,TimelineTimeChangedEvent:()=>E,TimelineUtils:()=>c,defaultTimelineConsts:()=>ue,defaultTimelineKeyframeStyle:()=>ae,defaultTimelineOptions:()=>ce,defaultTimelineRowStyle:()=>se,defaultTimelineStyle:()=>le});var i,o=function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=[],(t="_subscriptions")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t,i;return t=e,(i=[{key:"on",value:function(e,t){t&&this._subscriptions.push({topic:e,callback:t})}},{key:"off",value:function(e,t){this._subscriptions=this._subscriptions.filter((function(n){return n&&n.callback!=t&&n.topic!=e}))}},{key:"offAll",value:function(){this._subscriptions.length=0}},{key:"emit",value:function(e,t){this._subscriptions.forEach((function(n){n&&n.topic==e&&n.callback&&n.callback(t)}))}}])&&n(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}!function(e){e.None="none",e.Rhomb="rhomb",e.Circle="circle",e.Rect="rect"}(i||(i={}));var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"getKeyframeStyle",value:function(e,t,n,i,o){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=null;if(e){var a=e;if(void 0!==a[i]){var s=a[i];if(!r)return s;(l=l||[]).push(s)}}if(t&&t.keyframesStyle){var c=t.keyframesStyle;if(void 0!==c[i]){var u=c[i];if(!r)return u;(l=l||[]).push(u)}}var h=n?n.rowsStyle:null;if(h&&h.keyframesStyle){var f=h.keyframesStyle;if(void 0!==f[i]){var _=f[i];if(!r)return _;(l=l||[]).push(_)}}return r&&l&&l.length>0?l[l.length-1]:o}},{key:"getRowStyle",value:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=null;if(e){var l=e;if(void 0!==l[n]){var a=l[n];if(!o)return a;(r=r||[]).push(a)}}var s=t?t.rowsStyle:null;if(s){var c=s;if(void 0!==c[n]){var u=c[n];if(!o)return u;(r=r||[]).push(u)}}return o&&r&&r.length>0?r[r.length-1]:i}},{key:"keyframeShape",value:function(t,n,o){return e.getKeyframeStyle(t,n,o,"shape",i.Rhomb)}},{key:"keyframeFillColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"fillColor","DarkOrange")}},{key:"keyframeSelectedFillColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"selectedFillColor","red")}},{key:"keyframeStrokeThickness",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"strokeThickness",.2,!1)}},{key:"keyframeStrokeColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"strokeColor","Black",!1)}},{key:"keyframeSelectedStrokeColor",value:function(t,n,i){return e.getKeyframeStyle(t,n,i,"selectedStrokeColor","Black",!1)}},{key:"getRowHeight",value:function(t,n){return e.getRowStyle(t,n,"height",24)}},{key:"rowGroupHeight",value:function(t,n){return e.getRowStyle(t,n,"groupHeight","auto")}},{key:"groupFillColor",value:function(t,n){return e.getRowStyle(t,n,"groupFillColor")}},{key:"getRowMarginBottom",value:function(t,n){return e.getRowStyle(t,n,"marginBottom",0)}},{key:"getRowFillColor",value:function(t,n){return e.getRowStyle(t,n,"fillColor","#252526")}},{key:"headerHeight",value:function(e){return e?e.headerHeight:30}},{key:"keyframeDraggable",value:function(t,n,i){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e.getKeyframeStyle(t,n,i,"draggable",o,!1)}},{key:"groupDraggable",value:function(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.getRowStyle(t,n,"groupDraggable",i,!1)}}],null&&r(t.prototype,null),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=[1,2,5,10],c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"drawLine",value:function(e,t,n,i,o){e.moveTo(t,n),e.lineTo(i,o)}},{key:"isNumber",value:function(e){return!("number"!=typeof e||isNaN(e)||!Number.isFinite(e))}},{key:"deleteElement",value:function(e,t){var n=e.indexOf(t);return-1!==n?e.splice(n,1):e}},{key:"isOverlap",value:function(e,t,n){return!!n&&n.x<=e&&n.x+n.width>=e&&n.y<=t&&n.y+n.height>=t}},{key:"findGoodStep",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t<=0||isNaN(t)||!Number.isFinite(t))return t;for(var i=t,o=null,r=e.getPowArgument(t),l=0;l<s.length;l++){var a=s[l],c=a*Math.pow(10,r);if(!n||n%c==0){var u=e.getDistance(t,c);if(0==u||u<=.1&&r>0){o=u,i=c;break}(!o||o>u)&&(o=u,i=c)}}return i}},{key:"keepInBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.isNumber(t)&&(e.isNumber(n)&&(t=Math.max(t,n)),e.isNumber(i)&&(t=Math.min(t,i))),t}},{key:"setMinMax",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!n||!t)return t;var o=Math.min(n.getMin?n.getMin():n.min,n.min),r=Math.min(t.getMin?t.getMin():t.min,t.min),l=e.isNumber(o),a=e.isNumber(r);l&&a?t.min=i?Math.min(o,r):Math.max(o,r):l&&(t.min=o);var s=Math.min(n.getMax?n.getMax():n.max,n.max),c=Math.min(t.getMax?t.getMax():t.max,t.max),u=e.isNumber(s),h=e.isNumber(c);return u&&h?t.max=i?Math.max(s,c):Math.min(s,c):u&&(t.max=s),t}},{key:"isRectOverlap",value:function(e,t){return e&&t?e.x>t.x+t.width||t.x>e.x+e.width||e.y<t.y+t.height||t.y<e.y+e.height:(console.log("Rectangles cannot be empty"),!1)}},{key:"getDistance",value:function(e,t,n,i){return null!=n&&null!=i?Math.sqrt(Math.pow(e-n,2)+Math.pow(t-i,2)):Math.abs(e-t)}},{key:"sign",value:function(e){return e>=0?1:-1}},{key:"clearBrowserSelection",value:function(){if(window)if(window.getSelection)window.getSelection().removeAllRanges();else{var e=window.document;e.selection&&e.selection.empty()}}},{key:"getPowArgument",value:function(e){if(!e||0===e||!isFinite(e))return 1;if(e>=10&&e<100)return 1;if(e>=100&&e<1e3)return 2;if(e>=1e3&&e<1e4)return 3;e=Math.abs(e);var t=0,n=this.sign(e);if(e>1){for(;e>=1;)e=Math.floor(e/10),t++;return n*t-1}return e>0?Math.floor(Math.log(e)/Math.log(10)+1)-1:1}}],null&&a(t.prototype,null),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t="_prevented")in this?Object.defineProperty(this,t,{value:false,enumerable:!0,configurable:!0,writable:!0}):this[t]=false}var t,n;return t=e,(n=[{key:"preventDefault",value:function(){this._prevented=!0}},{key:"isPrevented",value:function(){return this._prevented}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function v(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g,b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=y(n);if(i){var o=y(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return v(this,e)});function r(){var e;_(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return m(p(e=o.call.apply(o,[this].concat(n))),"val",void 0),m(p(e),"prevVal",void 0),m(p(e),"target",void 0),m(p(e),"source",void 0),e}return t=r,Object.defineProperty(t,"prototype",{writable:!1}),t}(h);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function x(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.User="user",e.Programmatically="programmatically",e.SetTimeMethod="setTimeMethod"}(g||(g={}));var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=M(n);if(i){var o=M(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return x(this,e)});function r(){var e;k(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return C(P(e=o.call.apply(o,[this].concat(n))),"val",0),C(P(e),"prevVal",0),C(P(e),"source",g.User),e}return t=r,Object.defineProperty(t,"prototype",{writable:!1}),t}(h);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function D(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return N(e)}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(n);if(i){var o=z(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return D(this,e)});function r(){var e;R(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return K(N(e=o.call.apply(o,[this].concat(n))),"selected",[]),K(N(e),"changed",[]),e}return t=r,Object.defineProperty(t,"prototype",{writable:!1}),t}(h);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function W(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return I(e)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(n);if(i){var o=V(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return W(this,e)});function r(){var e;A(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return F(I(e=o.call.apply(o,[this].concat(n))),"args",void 0),F(I(e),"pos",void 0),F(I(e),"elements",void 0),F(I(e),"target",void 0),F(I(e),"val",void 0),F(I(e),"snapVal",void 0),F(I(e),"originalVal",void 0),e}return t=r,Object.defineProperty(t,"prototype",{writable:!1}),t}(h);function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},G(e,t)}function Y(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return X(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q,$,ee,te,ne,ie,oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G(e,t)}(r,e);var t,n,i,o=(n=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(n);if(i){var o=q(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return Y(this,e)});function r(){var e;U(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return J(X(e=o.call.apply(o,[this].concat(n))),"args",void 0),J(X(e),"pos",void 0),J(X(e),"elements",void 0),J(X(e),"target",void 0),J(X(e),"val",void 0),J(X(e),"prevVal",void 0),J(X(e),"snapVal",void 0),J(X(e),"originalVal",void 0),e}return t=r,Object.defineProperty(t,"prototype",{writable:!1}),t}(h);!function(e){e.Selection="selection",e.Pan="pan",e.NonInteractivePan="nonInteractivePan",e.Zoom="zoom",e.None="none"}(Q||(Q={})),function(e){e.Timeline="timeline",e.Keyframe="keyframe",e.Group="group",e.Row="row"}($||($={})),function(e){e.Alias="alias",e.AllScroll="all-scroll",e.Auto="auto",e.Cell="cell",e.ContextMenu="context-menu",e.ColResize="col-resize",e.Copy="copy",e.Crosshair="crosshair",e.Default="default",e.EResize="e-resize",e.EWResize="ew-resize",e.Grab="grab",e.Grabbing="grabbing",e.Help="help",e.Move="move",e.NResize="n-resize",e.NEResize="ne-resize",e.NESWResize="nesw-resize",e.NSResize="ns-resize",e.NWResize="nw-resize",e.NWSEResize="nwse-resize",e.NoDrop="no-drop",e.None="none",e.NotAllowed="not-allowed",e.Pointer="pointer",e.Progress="progress",e.RowResize="row-resize",e.SResize="s-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.Text="text",e.WResize="w-resize",e.Wait="wait",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out"}(ee||(ee={})),function(e){e.None="none",e.Triangle="triangle",e.Rect="rect"}(te||(te={})),function(e){e.Normal="normal",e.Append="append",e.Revert="revert"}(ne||(ne={})),function(e){e.Selected="selected",e.TimeChanged="timechanged",e.KeyframeChanged="keyframeChanged",e.DragStarted="dragStarted",e.Drag="drag",e.DragFinished="dragFinished",e.Scroll="scroll",e.ScrollFinished="scrollFinished",e.DoubleClick="doubleClick",e.MouseDown="mouseDown"}(ie||(ie={}));var re,le={width:2,marginTop:15,capWidth:4,capHeight:10,capType:te.Rect,strokeColor:"DarkOrange",fillColor:"DarkOrange"},ae={fillColor:"DarkOrange",shape:i.Rhomb,selectedFillColor:"red",strokeColor:"black",selectedStrokeColor:"black",strokeThickness:.2,draggable:!0},se={height:24,marginBottom:2,fillColor:"#252526",groupFillColor:"#094771",groupHeight:"auto",keyframesStyle:ae},ce={snapAllKeyframesOnMove:!1,snapEnabled:!0,timelineStyle:le,stepPx:120,stepVal:1e3,stepSmallPx:30,snapStep:200,leftMargin:25,headerFillColor:"#101011",fillColor:"#101011",labelsColor:"#D5D5D5",tickColor:"#D5D5D5",selectionColor:"White",rowsStyle:se,headerHeight:30,font:"11px sans-serif",zoom:1,zoomSpeed:.1,zoomMin:.1,zoomMax:8,controlKeyIsMetaKey:!1,scrollContainerClass:"scroll-container",groupsDraggable:!0,keyframesDraggable:!0,timelineInteractive:!0,min:0,max:Number.MAX_VALUE},ue={autoPanSpeed:50,scrollByDragSpeed:.12,clickDetectionMs:120,doubleClickTimeoutMs:400,scrollFinishedTimeoutMs:500,autoPanByScrollPadding:10,clickThreshold:3};function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function ve(e,t){if(t&&("object"===he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return pe(e)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(){return ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=me(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ye.apply(this,arguments)}function me(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ge(e)););return e}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}function be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.DefaultMode="none",e.ZoomMode="zoom",e.ScrollBySelection="scrollBySelection"}(re||(re={}));var we=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}(s,e);var t,n,o,r,a=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ge(o);if(r){var n=ge(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ve(this,e)});function s(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return fe(this,s),be(pe(n=a.call(this)),"_container",null),be(pe(n),"_canvas",null),be(pe(n),"_scrollContainer",null),be(pe(n),"_scrollContent",null),be(pe(n),"_ctx",null),be(pe(n),"_options",null),be(pe(n),"_startPos",null),be(pe(n),"_scrollStartPos",{x:0,y:0}),be(pe(n),"_currentPos",null),be(pe(n),"_selectionRect",null),be(pe(n),"_selectionRectEnabled",!1),be(pe(n),"_drag",null),be(pe(n),"_startedDragWithCtrl",!1),be(pe(n),"_startedDragWithShiftKey",!1),be(pe(n),"_scrollProgrammatically",!1),be(pe(n),"_clickTimeout",0),be(pe(n),"_lastClickTime",0),be(pe(n),"_lastClickPoint",null),be(pe(n),"_consts",ue),be(pe(n),"_clickAllowed",!1),be(pe(n),"_scrollFinishedTimerRef",null),be(pe(n),"_val",0),be(pe(n),"_pixelRatio",1),be(pe(n),"_currentZoom",0),be(pe(n),"_intervalRef",null),be(pe(n),"_autoPanLastActionDate",0),be(pe(n),"_isPanStarted",!1),be(pe(n),"_interactionMode",Q.Selection),be(pe(n),"_lastUsedArgs",null),be(pe(n),"_model",null),be(pe(n),"_scrollAreaClickOrDragStarted",!1),be(pe(n),"_handleKeyUp",(function(e){n._interactionMode===Q.Zoom&&n._setZoomCursor(e)})),be(pe(n),"_handleKeyDown",(function(e){n._interactionMode===Q.Zoom&&n._setZoomCursor(e)})),be(pe(n),"_handleBlurEvent",(function(){n._cleanUpSelection()})),be(pe(n),"_handleWindowResizeEvent",(function(){n.rescale(),n.redraw()})),be(pe(n),"_handleScrollMouseDownEvent",(function(){n._scrollAreaClickOrDragStarted=!0})),be(pe(n),"_handleScrollEvent",(function(e){var t=n._scrollProgrammatically;n._scrollProgrammatically&&(n._scrollProgrammatically=!1),n._clearScrollFinishedTimer(),n._scrollFinishedTimerRef=window.setTimeout((function(){n._isPanStarted||(n._clearScrollFinishedTimer(),n.rescale(),n.redraw()),n._emitScrollEvent(e,t,ie.ScrollFinished)}),n._consts.scrollFinishedTimeoutMs),n.redraw(),n._emitScrollEvent(e,t)})),be(pe(n),"_handleWheelEvent",(function(e){if(n._controlKeyPressed(e)){e.preventDefault();var t=Math.max(0,n._getMousePos(n._canvas,e).x||0);n._zoom(c.sign(e.deltaY),n._options.zoomSpeed,t)}else n._scrollContainer.scrollTop+=e.deltaY,e.preventDefault()})),be(pe(n),"_handleMouseDownEvent",(function(i){var o=Date.now()-n._lastClickTime<n._consts.doubleClickTimeoutMs;if(c.clearBrowserSelection(),n._startPos=n._trackMousePos(n._canvas,i),n._startPos){n._lastClickPoint&&n._startPos&&c.getDistance(n._lastClickPoint.x,n._lastClickPoint.y,n._startPos.x,n._startPos.y)>n._consts.clickThreshold&&(o=!1),n._lastClickPoint=n._startPos,n._scrollStartPos={x:n._scrollContainer.scrollLeft,y:n._scrollContainer.scrollTop},n._clickAllowed=!0;var r=null;n._interactionMode!==Q.NonInteractivePan&&n._interactionMode!==Q.None||(r=[$.Timeline]);var l=n.elementFromPoint(n._startPos,Math.max(2,n._startPos.radius),r),a=n._filterDraggableElements(l,n._startPos.val),u=new Z;if(u.pos=n._startPos,u.val=n._startPos.val,u.originalVal=n._startPos.originalVal,u.snapVal=n._startPos.snapVal,u.args=i,u.elements=l,u.target=a,o)ye((e=pe(n),ge(s.prototype)),"emit",e).call(e,ie.DoubleClick,u);else if(ye((t=pe(n),ge(s.prototype)),"emit",t).call(t,ie.MouseDown,u),n._clickTimeout=Date.now(),n._lastClickTime=Date.now(),u.isPrevented())n._cleanUpSelection();else{if(n._currentPos=n._startPos,a&&n._interactionMode!==Q.Zoom)if(n._drag={changed:!1,target:n._setElementDragState(a,a.val),val:a.val,type:a.type,elements:[]},a.type===$.Keyframe)n._startedDragWithCtrl=n._controlKeyPressed(i),n._startedDragWithShiftKey=i.shiftKey,a.keyframe.selected||n._controlKeyPressed(i)||n._selectInternal(a.keyframe),n._drag.elements=n.getSelectedElements().map((function(e){return n._setElementDragState(e,e.val)}));else if(a.type===$.Group){var h=n._drag.target.keyframes;h&&Array.isArray(h)&&(n._drag.elements=h.map((function(e){return n._setElementDragState(n._convertToElement(n._drag.target.row,e),e.val)})))}else n._drag.elements=[n._drag.target];n.redraw()}}})),be(pe(n),"_handleMouseMoveEvent",(function(e){if(e?n._lastUsedArgs=e:e=n._lastUsedArgs,e){var t=e.changedTouches&&e.changedTouches.length>0;n._currentPos=n._trackMousePos(n._canvas,e),!n._isPanStarted&&n._selectionRect&&n._clickTimeoutIsOver()?n._interactionMode===Q.None||n._interactionMode===Q.Zoom||n._interactionMode===Q.NonInteractivePan?n._selectionRectEnabled=!1:n._selectionRectEnabled=!0:n._selectionRectEnabled=!1;var i=n.isLeftButtonClicked(e);if(i||(n._scrollAreaClickOrDragStarted=!1),n._startPos)if(i||t){if(n._drag&&!n._startedDragWithCtrl){var o=n._currentPos.val;if(n._drag.type===$.Timeline)n._setTimeInternal(o,g.User);else if((n._drag.type==$.Keyframe||n._drag.type==$.Group)&&n._drag.elements){var r=Math.floor(o-n._drag.val);if(0!==n._moveElements(r,n._drag.elements,g.User)){if(!n._drag.changed&&(n._drag.prevVal=n._drag.val,n._emitDragStartedEvent().isPrevented()))return n._drag=null,void n._cleanUpSelection();n._drag.changed=!0,n._drag.val+=r,n._emitDragEvent()}}}n._interactionMode!==Q.Pan&&n._interactionMode!==Q.NonInteractivePan||n._drag?n._interactionMode!==Q.None&&n._scrollBySelectionOutOfBounds(n._currentPos):(n._isPanStarted=!0,n._setCursor(ee.Grabbing),n._scrollByPan(n._startPos,n._currentPos,n._scrollStartPos)),n.redraw()}else n._cleanUpSelection(),n.redraw();else if(!t){var l=null;n._interactionMode!==Q.NonInteractivePan&&n._interactionMode!==Q.None||(l=[$.Timeline]);var a=n.elementFromPoint(n._currentPos,Math.max(2,n._currentPos.radius),l),s=n._filterDraggableElements(a,n._currentPos.val);if(n._isPanStarted||n._interactionMode===Q.Pan||n._interactionMode===Q.NonInteractivePan)i?n._setCursor(ee.Grabbing):n._setCursor(ee.Grab);else{if(n._interactionMode===Q.Zoom)return void n._setZoomCursor(e);n._setCursor(ee.Default)}if(s){var c=null;s.type===$.Group?c=c||ee.EWResize:s.type==$.Keyframe?c=c||ee.Pointer:s.type==$.Timeline&&(c=c||ee.EWResize),c&&n._setCursor(c)}}t&&e.preventDefault()}})),be(pe(n),"_handleMouseUpEvent",(function(e){if(n._scrollAreaClickOrDragStarted=!1,n._startPos){var t=n._trackMousePos(n._canvas,e);if(n._clickAllowed||!n._clickTimeoutIsOver()||n._drag&&(n._startedDragWithCtrl||n._startedDragWithShiftKey))if(n._options&&n._interactionMode===Q.Zoom){var i=n._controlKeyPressed(e)?1:-1,o=Math.max(0,n._getMousePos(n._canvas,e).x||0);n._zoom(i,n._options.zoomSpeed,o)}else n._performClick(t,n._drag);else if(!n._drag&&n._selectionRect&&n._selectionRectEnabled)if(n._interactionMode===Q.Zoom)n._selectionRect.width;else if(n._interactionMode!==Q.None){var r=n._getKeyframesByRectangle(n._selectionRect),l=e.shiftKey?ne.Append:ne.Normal;n.select(r,l)}n._cleanUpSelection(),n.redraw()}})),be(pe(n),"_redrawInternal",(function(){n._ctx&&(n.valToPx(n._val)>n._scrollContainer.scrollWidth&&(n.rescale(),!n._isPanStarted&&n._drag&&n._drag.type!==$.Timeline&&n.scrollLeft()),n._renderBackground(),n._renderRows(),n._renderHeaderBackground(),n._renderTicks(),n._renderKeyframes(),n._renderSelectionRect(),n._renderTimeline())})),n._options=n._cloneOptions(ce),i||o?n.initialize(i,o):console.log("No HTML element is attached to the timeline. initialize method should be called with id."),n}return t=s,n=[{key:"initialize",value:function(e,t){if(this._model=t,!e||!e.id)throw new Error("Element cannot be empty. Should be string or DOM element.");this._generateContainers(e.id),this._options=this._cloneOptions(ce),e&&(this._options=this._setOptions(e)),this._subscribeComponentEvents(),this.rescale(),this.redraw()}},{key:"_generateContainers",value:function(e){if(e instanceof HTMLElement?this._container=e:this._container=document.getElementById(e),!this._container)throw new Error("Element cannot be empty. Should be string or DOM element.");if(this._scrollContainer=document.createElement("div"),this._scrollContent=document.createElement("div"),this._canvas=document.createElement("canvas"),!this._canvas||!this._canvas.getContext)return console.log("Cannot initialize canvas context."),null;this._container.style.position="relative",this._canvas.style.cssText="image-rendering: -moz-crisp-edges;image-rendering: -webkit-crisp-edges;image-rendering: pixelated;image-rendering: crisp-edges;user-select: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-o-user-select: none;user-select: none;touch-action: none;position: relative;-webkit-user-drag: none;-khtml-user-drag: none;-moz-user-drag: none;-o-user-drag: none;user-drag: none;padding: inherit",this._scrollContainer.style.cssText="overflow: scroll;position: absolute;width:  100%;height:  100%;",this._scrollContent.style.width=this._scrollContent.style.height="100%",this._scrollContainer.appendChild(this._scrollContent),this._container.appendChild(this._scrollContainer);var t=this._scrollContainer.offsetWidth-this._scrollContent.clientWidth;this._canvas.style.width=this._canvas.style.height="calc(100% -"+(t||17)+"px)",this._container.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d")}},{key:"_subscribeComponentEvents",value:function(){if(this._unsubscribeComponentEvents(),!this._container||!this._scrollContainer||!this._canvas)throw Error("Cannot subscribe on scroll events while one of the containers is null or empty. Please call initialize method first");this._container&&this._container.addEventListener("wheel",this._handleWheelEvent),this._scrollContainer&&(this._scrollContainer.addEventListener("scroll",this._handleScrollEvent),this._scrollContainer.addEventListener("touchstart",this._handleScrollMouseDownEvent),this._scrollContainer.addEventListener("mousedown",this._handleScrollMouseDownEvent)),document.addEventListener("keyup",this._handleKeyUp,!1),document.addEventListener("keydown",this._handleKeyDown,!1),window.addEventListener("blur",this._handleBlurEvent,!1),window.addEventListener("resize",this._handleWindowResizeEvent,!1),this._canvas&&(this._canvas.addEventListener("touchstart",this._handleMouseDownEvent,!1),this._canvas.addEventListener("mousedown",this._handleMouseDownEvent,!1)),window.addEventListener("mousemove",this._handleMouseMoveEvent,!1),window.addEventListener("touchmove",this._handleMouseMoveEvent,!1),window.addEventListener("mouseup",this._handleMouseUpEvent,!1),window.addEventListener("touchend",this._handleMouseUpEvent,!1)}},{key:"_unsubscribeComponentEvents",value:function(){this._container.removeEventListener("wheel",this._handleWheelEvent),this._scrollContainer?(this._scrollContainer.removeEventListener("scroll",this._handleScrollEvent),this._scrollContainer.removeEventListener("touchstart",this._handleScrollMouseDownEvent),this._scrollContainer.removeEventListener("mousedown",this._handleScrollMouseDownEvent)):console.warn("Cannot unsubscribe scroll while it's already empty"),window.removeEventListener("blur",this._handleBlurEvent),window.removeEventListener("resize",this._handleWindowResizeEvent),document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("keyup",this._handleKeyUp),this._canvas?(this._canvas.removeEventListener("touchstart",this._handleMouseDownEvent),this._canvas.removeEventListener("mousedown",this._handleMouseDownEvent)):console.warn("Cannot unsubscribe canvas while it's already empty"),window.removeEventListener("mousemove",this._handleMouseMoveEvent),window.removeEventListener("touchmove",this._handleMouseMoveEvent),window.removeEventListener("mouseup",this._handleMouseUpEvent),window.removeEventListener("touchend",this._handleMouseUpEvent)}},{key:"dispose",value:function(){this.offAll(),this._stopAutoPan(),this._clearScrollFinishedTimer(),this._unsubscribeComponentEvents(),this._container=null,this._canvas=null,this._scrollContainer=null,this._scrollContent=null,this._ctx=null,this._cleanUpSelection()}},{key:"_setZoomCursor",value:function(e){this._controlKeyPressed(e)?this._setCursor(ee.ZoomOut):this._setCursor(ee.ZoomIn)}},{key:"_clearScrollFinishedTimer",value:function(){this._scrollFinishedTimerRef&&(clearTimeout(this._scrollFinishedTimerRef),this._scrollFinishedTimerRef=null)}},{key:"_controlKeyPressed",value:function(e){return this._options&&void 0!==this._options.controlKeyIsMetaKey?this._options.controlKeyIsMetaKey||this._options.controlKeyIsMetaKey?e.metaKey:e.ctrlKey:e.metaKey||e.ctrlKey}},{key:"_zoom",value:function(e,t,n){if(t>0&&t<=1){n+=.2*c.getDistance(this._width()/2,n);var i=this._width()/n,o=this._fromScreen(n),r=e*this._currentZoom*t;this._currentZoom=this._setZoom(this._currentZoom+r);var l=this.valToPx(o),a=Math.round(l-this._width()/i);a<=0&&(a=0),this._rescaleInternal(a+this._width(),null,re.ZoomMode),this._scrollContainer.scrollLeft!=a&&this.setScrollLeft(a),this.redraw()}}},{key:"zoomIn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._options.zoomSpeed;this._zoom(1,e,this._scrollContainer.clientWidth/2)}},{key:"zoomOut",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._options.zoomSpeed;this._zoom(-1,e,this._scrollContainer.clientWidth/2)}},{key:"_setZoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t=c.isNumber(t)?t:this._options?this._options.zoomMin:null,n=c.isNumber(n)?n:this._options?this._options.zoomMax:null,c.isNumber(e)?(e=(e=c.keepInBounds(e,t,n))||1,this._currentZoom=e,e):e}},{key:"setZoom",value:function(e){var t=this.getZoom();if(t!==e){var n=this._setZoom(e);if(t!=n)return this.rescale(),this.redraw(),n}return t}},{key:"getZoom",value:function(){return c.isNumber(this._currentZoom)&&this._currentZoom||1}},{key:"_setElementDragState",value:function(e,t){var n=e;return n.prevVal=n.val,void 0!==n.startedVal&&null!==n.startedVal||(n.startedVal=t),void 0!==n.prevVal&&null!==n.prevVal||(n.prevVal=t),n.val=t,n}},{key:"isLeftButtonClicked",value:function(e){return!!e&&1==e.buttons}},{key:"_moveElements",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Programmatically;if(t){var o=!1;if(Math.abs(e)>0){var r={min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER};if(r=c.setMinMax(r,this._options),t.forEach((function(t){var i=c.setMinMax(c.setMinMax({min:r.min,max:r.max},t.keyframe),t.row),o=(n._options&&n._options.snapAllKeyframesOnMove?n.snapVal(t.keyframe.val):t.keyframe.val)+e;c.isNumber(i.min)&&o<i.min&&(e+=c.getDistance(i.min,o)),c.isNumber(i.max)&&o>i.max&&(e-=c.getDistance(i.max,o))})),Math.abs(e)>0&&t.forEach((function(t){var r=t.keyframe.val,l=r+e,a=n._setKeyframePos(t,l,i);o=a!==r})),o)return e}return 0}}},{key:"_height",value:function(){return this._canvas?this._canvas.clientHeight:0}},{key:"_width",value:function(){return this._canvas?this._canvas.clientWidth:0}},{key:"_mapKeyframes",value:function(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++)t.push(e[n].model||e[n].keyframe);return t}},{key:"_getKeyframesByRectangle",value:function(e){var t=[];return this._forEachKeyframe((function(n){c.isOverlap(n.size.x,n.size.y,e)&&t.push(n.model)})),t}},{key:"_performClick",value:function(e,t){var n=!1;if(t&&t.type===$.Keyframe){var i,o=ne.Normal;this._startedDragWithCtrl&&this._controlKeyPressed(e.args)?this._controlKeyPressed(e.args)&&(o=ne.Revert):this._startedDragWithShiftKey&&e.args.shiftKey&&(o=ne.Append),n=this._selectInternal(this._drag.target.keyframe,o).selectionChanged||n,e.args.shiftKey&&!1!==(null===(i=this._options)||void 0===i?void 0:i.timelineInteractive)&&(n=this._setTimeInternal(e.val,g.User)||n)}else{var r;n=this._selectInternal(null).selectionChanged||n,!1!==(null===(r=this._options)||void 0===r?void 0:r.timelineInteractive)&&(n=this._setTimeInternal(e.val,g.User)||n)}return n}},{key:"_setKeyframePos",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Programmatically;if(!e||!e.keyframe)return t;if(t=Math.floor(t),e.keyframe&&e.keyframe.val!=t){e.prevVal=e.val,e.val=t,e.keyframe.val=t;var i=this._emitKeyframeChanged(e,n);return i.isPrevented()&&(e.val=i.prevVal,e.keyframe.val=i.prevVal),t}return t}},{key:"_setCursor",value:function(e){this._canvas.style.cursor!=e&&(this._canvas.style.cursor=e)}},{key:"setInteractionMode",value:function(e){this._interactionMode!=e&&(this._interactionMode=e,this._cleanUpSelection(),this.redraw())}},{key:"getInteractionMode",value:function(){return this._interactionMode}},{key:"_convertToElement",value:function(e,t){return{type:$.Keyframe,val:t.val,keyframe:t,row:e}}},{key:"getSelectedKeyframes",value:function(){return this._mapKeyframes(this.getSelectedElements())}},{key:"getSelectedElements",value:function(){var e=this,t=[];return this._forEachKeyframe((function(n){n&&n.model.selected&&t.push(e._convertToElement(n.parentRow.model,n.model))})),t}},{key:"getAllKeyframes",value:function(){var e=[];return this._forEachKeyframe((function(t){e.push(t.model)})),e}},{key:"selectAllKeyframes",value:function(){return this.select(this.getAllKeyframes(),ne.Normal)}},{key:"deselectAll",value:function(){return this.select(null)}},{key:"_changeNodeState",value:function(e,t,n){if(t.selected!==n){var i="boolean"!=typeof t.selectable||t.selectable;if(!n||n&&i)return t.selected=n,e.changed.push(t),!0}return!1}},{key:"select",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne.Normal,n=this._selectInternal(e,t);return n.selectionChanged&&this.redraw(),n}},{key:"_selectInternal",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne.Normal;e||(e=[]),Array.isArray(e)||(e=[e]);var i={selectionChanged:!1,selected:this.getSelectedKeyframes(),changed:[]},o=e;if(o&&n===ne.Append)e.forEach((function(e){t._changeNodeState(i,e,!0)&&e.selected&&i.selected.push(e)}));else if(o&&n===ne.Revert)e.forEach((function(e){i.selected.indexOf(e)>=0?(t._changeNodeState(i,e,!1),c.deleteElement(i.selected,e)):(t._changeNodeState(i,e,!0),e.selected&&i.selected.push(e))}));else if(n===ne.Normal){var r=[];e&&e.forEach((function(e){t._changeNodeState(i,e,!0),e.selected&&r.push(e)})),i.selected.forEach((function(e){o.indexOf(e)>=0||t._changeNodeState(i,e,!1)})),i.changed.length>0&&(r?i.selected=r:i.selected.length=0)}return i.changed.length>0&&(i.selectionChanged=!0,this._emitKeyframesSelected(i)),i}},{key:"_forEachKeyframe",value:function(e){if(e&&this._model){var t=this._calculateModel();t&&t.rows.forEach((function(t){if(t){var n=!0;t.keyframes.forEach((function(t,i){t&&e(t,i,n),n=!1}))}}))}}},{key:"_trackMousePos",value:function(e,t){var n=this._getMousePos(e,t);if(n.originalVal=this._mousePosToVal(n.x,!1),n.snapVal=this._mousePosToVal(n.x,!0),n.val=n.originalVal,this._options&&this._options.snapEnabled&&(n.val=n.snapVal),this._startPos){this._selectionRect||(this._selectionRect={});var i=Math.floor(this._startPos.x+(this._scrollStartPos.x-this.getScrollLeft())),o=Math.floor(this._startPos.y+(this._scrollStartPos.y-this.getScrollTop()));this._selectionRect.x=Math.min(i,n.x),this._selectionRect.y=Math.min(o,n.y),this._selectionRect.width=Math.max(i,n.x)-this._selectionRect.x,this._selectionRect.height=Math.max(o,n.y)-this._selectionRect.y,this._clickAllowed&&(this._clickAllowed=this._selectionRect.height<=this._consts.clickThreshold&&this._selectionRect.width<=this._consts.clickThreshold)}return n}},{key:"getClientWidth",value:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.clientWidth)||0}},{key:"getClientHeight",value:function(){var e;return(null===(e=this._scrollContainer)||void 0===e?void 0:e.clientHeight)||0}},{key:"_cleanUpSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._emitDragFinishedEvent(e),this._startPos=null,this._drag=null,this._scrollAreaClickOrDragStarted=!1,this._startedDragWithCtrl=!1,this._startedDragWithShiftKey=!1,this._selectionRect=null,this._clickTimeout=null,this._scrollStartPos=null,this._isPanStarted=!1,this._clickAllowed=!1,this._stopAutoPan()}},{key:"_clickTimeoutIsOver",value:function(){return!!(this._clickTimeout&&Date.now()-this._clickTimeout>this._consts.clickDetectionMs)}},{key:"_startAutoPan",value:function(){var e=this;this._consts.autoPanSpeed&&(this._intervalRef||(this._intervalRef=window.setInterval((function(){e._handleMouseMoveEvent(null)}),this._consts.autoPanSpeed)))}},{key:"_stopAutoPan",value:function(){this._intervalRef&&(clearInterval(this._intervalRef),this._intervalRef=null),this._autoPanLastActionDate=null}},{key:"_checkUpdateSpeedTooFast",value:function(){return!!(this._autoPanLastActionDate&&Date.now()-this._autoPanLastActionDate<=10)||(this._autoPanLastActionDate=Date.now(),!1)}},{key:"_scrollByPan",value:function(e,t,n){if(e&&t){var i=Math.round(e.x-t.x),o=n.x+i;i>0&&this._rescaleInternal(o+this._width()),i>0&&o+this._width()>=this._scrollContainer.scrollWidth-5?this.setScrollLeft(this._scrollContainer.scrollWidth):this.setScrollLeft(o),this._scrollContainer.scrollTop=Math.round(n.y+e.y-t.y)}}},{key:"_scrollBySelectionOutOfBounds",value:function(e){var t=e.x,n=e.y,i=!1,o=0,r=0,l=this._consts.autoPanByScrollPadding,a=t<=l,s=t>=this._width()-l,u=n<=l,h=n>=this._height()-l,f=null,_=null;if(a||s||u||h){if(this._startAutoPan(),this._checkUpdateSpeedTooFast())return!1;var d=isNaN(this._consts.scrollByDragSpeed)?1:this._consts.scrollByDragSpeed;a?o=-c.getDistance(t,l)*d:s&&(o=c.getDistance(t,this._width()-l)*d,f=this.getScrollLeft()+this._width()+o),u?r=-c.getDistance(t,l)*d/4:h&&(r=c.getDistance(t,this._height()-l)*d/4,_=this._scrollContainer.scrollTop+this._height())}else this._stopAutoPan();return(f||_)&&this._rescaleInternal(f,_,re.ScrollBySelection),Math.abs(o)>0&&(this.setScrollLeft(this._scrollContainer.scrollLeft+o),i=!0),Math.abs(r)>0&&(this.setScrollTop(this._scrollContainer.scrollTop+r),i=!0),i}},{key:"pxToVal",value:function(e){if(!this._options)return e;var t=this._options.min;c.isNumber(t)||(t=0),t*=this._currentZoom||1;var n=(this._options.stepVal||0)*this._currentZoom||1;return t+e/this._options.stepPx*n}},{key:"_toScreenPx",value:function(e){return this.valToPx(e)-this.getScrollLeft()+this._leftMargin()}},{key:"_fromScreen",value:function(e){return this.pxToVal(this.getScrollLeft()+e-this._leftMargin())}},{key:"valToPx",value:function(e){if(!this._options)return e;var t=this._options.min;c.isNumber(t)||(t=0),t*=this._currentZoom||1;var n=(this._options.stepVal||0)*this._currentZoom||1;return(-t+e)*(this._options.stepPx/n)}},{key:"snapVal",value:function(e){if(this._options&&this._options.snapEnabled&&this._options.snapStep){var t=this._options.snapStep,n=e/t,i=Math.round(n),o=Math.abs(this._options.min)/this._options.snapStep,r=c.sign(this._options.min)*(o-Math.floor(o))*this._options.snapStep;e=Math.round(r)+Math.round(i*t)}return c.keepInBounds(e,this._options.min,this._options.max)}},{key:"_mousePosToVal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Math.min(e,this._width()),i=this._fromScreen(n);return i=Math.round(i),t&&(i=this.snapVal(i)),i}},{key:"_formatUnitsText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=c.sign(e)<0?"-":"",i=(e=Math.abs(e))/1e3;t&&(i=e);var o=Math.floor(i/31536e3);i%=31536e3;var r=Math.floor(i/86400);i%=86400;var l=Math.floor(i/3600);i%=3600;var a=Math.floor(i/60);i%=60;var s="";return o&&(s+=o+":"),r&&(s+=r+":"),l&&(s+=l+":"),a&&(s+=a+":"),isNaN(i)||(s+=i),n+s}},{key:"_leftMargin",value:function(){return this._options&&this._options.leftMargin||0}},{key:"_renderTicks",value:function(){if(this._ctx&&this._options&&this._ctx.canvas&&this._ctx.canvas.clientWidth>0&&this._ctx.canvas.clientHeight>0&&this._options.stepPx){var e=this._width()-this._leftMargin(),t=this.pxToVal(this.getScrollLeft()),n=this.pxToVal(this.getScrollLeft()+e);if(!isNaN(t)&&!isNaN(n)&&t!==n){if(n<t){var i=n;n=t,t=i}var o=c.getDistance(t,n);if(!(o<=0)){var r=c.findGoodStep(o/(e/this._options.stepPx)),a=c.findGoodStep(o/(e/this._options.stepSmallPx)),s=Math.floor(t/r)*r,u=Math.ceil(n/r)*r+r;if(c.isNumber(r)&&!(r<=0)&&0!==Math.abs(u-s)){var h=0;this._ctx.save();for(var f=l.headerHeight(this._options),_=f/2,d=f/1.3,v=s;v<=u;v+=r){var p=this._getSharp(this._toScreenPx(v));this._ctx.save(),this._ctx.beginPath(),this._ctx.setLineDash([4]),this._ctx.lineWidth=1,this._ctx.strokeStyle=this._options.tickColor,c.drawLine(this._ctx,p,_,p,f),this._ctx.stroke(),this._ctx.fillStyle=this._options.labelsColor,this._options.font&&(this._ctx.font=this._options.font);var y=this._formatUnitsText(v),m=this._ctx.measureText(y),g=p-m.width/2;if((isNaN(h)||h<=g)&&(h=g+m.width,this._ctx.fillText(y,g,10)),this._ctx.restore(),c.isNumber(a)&&!(a<=0))for(var b=v+a;b<v+r;b+=a){var w=this._getSharp(this._toScreenPx(b));this._ctx.beginPath(),this._ctx.lineWidth=this._pixelRatio,this._ctx.strokeStyle=this._options.tickColor,c.drawLine(this._ctx,w,d,w,f),this._ctx.stroke()}}this._ctx.restore()}}}}}},{key:"_calculateModel",value:function(){var e=this,t={rows:[],size:{x:0,y:0,width:0,height:0},min:null,max:null,keyframes:[]};if(!this._model)return t;var n=this._model.rows;if(!n||!Array.isArray(n)||n.length<=0)return t;var i=l.headerHeight(this._options);return n.forEach((function(n,o){if(n&&!n.hidden){var r=l.getRowHeight(n,e._options),a=l.getRowMarginBottom(n,e._options),s=i-(e._scrollContainer?e._scrollContainer.scrollTop:0);i+=r+a,0==o&&(t.size.y=s),t.size.height=Math.max(i+r,t.size.height);var u={size:{x:0,y:s,width:e._canvas?e._width():0,height:r},marginBottom:a,model:n,min:null,max:null,groups:[],keyframes:[]};t.rows.push(u),!n.keyframes||!n.keyframes.forEach||n.keyframes.length<=0||(n&&n.keyframes&&n.keyframes.forEach((function(n){if(n&&!isNaN(n.val)&&!n.hidden){for(var i=null,o=0;o<u.groups.length;o++){var r=u.groups[o];if(n.group===r.group){i=r;break}}i||(i={min:null,max:null,group:n.group,keyframes:[]},u.groups.push(i));var l=e._getKeyframePosition(n,u),a={model:n,parentRow:u,parentGroup:i,size:l},s=null==i.min?n.val:Math.min(n.val,i.min),c=null==i.max?n.val:Math.max(n.val,i.max);isNaN(s)||(i.min=s),isNaN(c)||(i.max=c),u.keyframes.push(a),i.keyframes.push(a),t.keyframes.push(a)}})),u.groups.forEach((function(t){c.setMinMax(u,t,!0);var i=e._getKeyframesGroupSize(n,u.size.y,t.min,t.max);t.size=i})),c.setMinMax(t,u,!0))}})),c.isNumber(t.max)&&(t.size.width=this.valToPx(t.max)),t}},{key:"_renderRows",value:function(){var e=this,t=this._calculateModel();t&&t.rows&&(this._ctx.save(),t.rows.forEach((function(t){if(t){e._ctx.fillStyle=l.getRowFillColor(t.model,e._options);var n=e._cutBounds(t.size);n&&e._ctx.fillRect(n.x,n.y,n.width,n.height);var i=l.groupFillColor(t.model,e._options);t.groups&&t.groups.forEach((function(t){var n=e._cutBounds(t.size);n&&(e._ctx.fillStyle=i,e._ctx.fillRect(n.x,n.y,n.width,n.height))}))}})),this._ctx.restore())}},{key:"_cutBounds",value:function(e){if(!e)return null;var t=this._width(),n=l.headerHeight(this._options),i=this._width();if(c.isRectOverlap(e,{x:0,y:n,width:c.getDistance(0,t),height:c.getDistance(n,i)})){var o=Math.max(e.y,n),r=Math.max(e.x,0),a=e.x-r,s=e.y-o;return{height:e.height+s,width:e.width+a,x:r,y:o,overlapY:Math.abs(s)>0,overlapX:Math.abs(a)>0}}return null}},{key:"_getKeyframesGroupSize",value:function(e,t,n,i){var o=l.rowGroupHeight(e,this._options),r=l.getRowHeight(e,this._options);(!o&&0!==o||isNaN(o)||"auto"==o)&&(o=Math.floor(.7*r)),o>r&&(o=r);var a=r-o,s=this._toScreenPx(n),u=this._toScreenPx(i);return{x:s,y:t+Math.floor(a/2),height:o,width:c.getDistance(s,u)}}},{key:"_getKeyframePosition",value:function(e,t){if(!e)return console.log("keyframe should be defined."),null;var n=e.val;if(isNaN(n))return null;var i=t.size,o=i.y+i.height/2,r=l.getKeyframeStyle(e,t.model,this._options,"height","auto"),a=l.getKeyframeStyle(e,t.model,this._options,"width","auto");return"auto"==r&&(r=i.height/3),"auto"==a&&(a=r),r>0&&!isNaN(n)?{x:Math.floor(this._toScreenPx(n)),y:Math.floor(o),height:r,width:a}:null}},{key:"_renderKeyframes",value:function(){var e=this;this._forEachKeyframe((function(t){var n=t.parentRow.model,o=t.size,r=t.model;if(o){var a=e._getSharp(o.x),s=o.y,c=e._cutBounds({x:a-o.width/2,y:s-o.height/2,width:o.width,height:o.height});if(!c)return;e._ctx.save(),c&&c.overlapY&&(e._ctx.beginPath(),e._ctx.rect(0,l.headerHeight(e._options),e._width(),e._width()),e._ctx.clip());var u=l.keyframeShape(r,n,e._options);if(u===i.None)return;var h=r.selected?l.keyframeSelectedFillColor(r,n,e._options):l.keyframeFillColor(r,n,e._options),f=l.keyframeStrokeThickness(r,n,e._options),_="";f>0&&(_=r.selected?l.keyframeSelectedStrokeColor(r,n,e._options):l.keyframeStrokeColor(r,n,e._options)),u==i.Rhomb?(e._ctx.beginPath(),e._ctx.translate(a,s),e._ctx.rotate(45*Math.PI/180),f>0&&_&&(e._ctx.fillStyle=_,e._ctx.rect(-o.width/2,-o.height/2,o.width,o.height),e._ctx.fill()),e._ctx.fillStyle=h,e._ctx.translate(f,f),e._ctx.rect(-o.width/2,-o.height/2,o.width-2*f,o.height-2*f),e._ctx.fill()):u==i.Circle?(e._ctx.beginPath(),f>0&&_&&(e._ctx.fillStyle=_,e._ctx.arc(a,s,o.height,0,2*Math.PI)),e._ctx.fillStyle=h,e._ctx.arc(a,s,o.height-f,0,2*Math.PI),e._ctx.fill()):u==i.Rect&&(e._ctx.beginPath(),s-=o.height/2,a-=o.width/2,f>0&&_&&(e._ctx.fillStyle=_,e._ctx.rect(a,s,o.width,o.height),e._ctx.fill()),e._ctx.fillStyle=h,e._ctx.rect(a+f,s+f,o.width-f,o.height-f),e._ctx.fill()),e._ctx.restore()}}))}},{key:"_renderSelectionRect",value:function(){this._drag||(this._ctx.save(),this._selectionRect&&this._selectionRectEnabled&&(this._ctx.setLineDash([4]),this._ctx.lineWidth=this._pixelRatio,this._ctx.strokeStyle=this._options.selectionColor,this._ctx.strokeRect(this._getSharp(this._selectionRect.x,1),this._getSharp(this._selectionRect.y,1),Math.floor(this._selectionRect.width),Math.floor(this._selectionRect.height))),this._ctx.restore())}},{key:"_renderBackground",value:function(){this._options.fillColor?(this._ctx.save(),this._ctx.beginPath(),this._ctx.rect(0,0,this._width(),this._height()),this._ctx.fillStyle=this._options.fillColor,this._ctx.fill(),this._ctx.restore()):this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"_renderTimeline",value:function(){if(this._ctx&&this._options&&this._options.timelineStyle){var e=this._options.timelineStyle;this._ctx.save();var t=e.width||1;this._ctx.lineWidth=t*this._pixelRatio;var n=this._getSharp(this._toScreenPx(this._val),t);this._ctx.strokeStyle=e.strokeColor,this._ctx.fillStyle=e.fillColor;var i=e.marginTop;if(this._ctx.beginPath(),c.drawLine(this._ctx,n,i,n,this._height()),this._ctx.stroke(),e.capHeight&&e.capWidth){var o=e.capWidth,r=e.capHeight;e.capType===te.Triangle?(this._ctx.beginPath(),this._ctx.moveTo(n-o/2,i),this._ctx.lineTo(n+o/2,i),this._ctx.lineTo(n,r),this._ctx.closePath(),this._ctx.stroke()):e.capType===te.Rect&&(this._ctx.fillRect(n-o/2,i,o,r),this._ctx.fill())}this._ctx.restore()}}},{key:"_renderHeaderBackground",value:function(){this._ctx&&this._options&&l.headerHeight(this._options)&&(this._ctx.save(),this._ctx.lineWidth=this._pixelRatio,this._options.headerFillColor?(this._ctx.lineWidth=this._pixelRatio,this._ctx.fillStyle=this._options.headerFillColor,this._ctx.fillRect(0,0,this._width(),l.headerHeight(this._options))):this._ctx.clearRect(0,0,this._width(),l.headerHeight(this._options)),this._ctx.restore())}},{key:"redraw",value:function(){window.requestAnimationFrame?window.requestAnimationFrame(this._redrawInternal):this._redrawInternal()}},{key:"scrollLeft",value:function(){this._scrollContainer&&this._scrollContainer.scrollLeft!=this._scrollContainer.scrollWidth&&this.setScrollLeft(this._scrollContainer.scrollWidth)}},{key:"getRowByY",value:function(e){var t=this._calculateModel();if(t&&t.rows)for(var n=0;n<t.rows.length;n++){var i=t.rows[n].size;if(i&&i.y>=e&&e<=i.y+i.height)return i}return null}},{key:"_getSharp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=Math.round(e),t%2==0?e:e+this._pixelRatio/2}},{key:"getTime",value:function(){return this._val}},{key:"_setTimeInternal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.Programmatically;if((e=Math.round(e))<this._options.min&&(e=this._options.min),this._val!=e){var n=this._val,i=new E;return i.val=e,i.prevVal=n,i.source=t,this._val=e,this.emit(ie.TimeChanged,i),!i.isPrevented()||(this._val=n,!1)}return!1}},{key:"setTime",value:function(e){if(this._drag&&this._drag.type===$.Timeline)return!1;var t=this._setTimeInternal(e,g.SetTimeMethod);return t&&(this.rescale(),this.redraw()),t}},{key:"getOptions",value:function(){return this._options}},{key:"setScrollLeft",value:function(e){this._scrollContainer&&this._scrollContainer.scrollLeft!==e&&(this._scrollProgrammatically=!0,this._scrollContainer.scrollLeft=e)}},{key:"setScrollTop",value:function(e){this._scrollContainer&&this._scrollContainer.scrollTop!==e&&(this._scrollProgrammatically=!0,this._scrollContainer.scrollTop=e)}},{key:"getScrollLeft",value:function(){return this._scrollContainer?this._scrollContainer.scrollLeft:0}},{key:"getScrollTop",value:function(){return this._scrollContainer?this._scrollContainer.scrollTop:0}},{key:"setOptions",value:function(e){return this._options=this._setOptions(e),this.rescale(),this.redraw(),this._options}},{key:"_applyContainersStyles",value:function(){if(this._scrollContainer&&this._options){var e=this._scrollContainer.classList;this._options.scrollContainerClass&&!e.contains(this._options.scrollContainerClass)&&e.add(this._options.scrollContainerClass),this._options.fillColor&&(this._scrollContainer.style.background=this._options.fillColor)}}},{key:"_setOptions",value:function(e){return e?(this._options=this._mergeOptions(this._options,e),this._options.snapStep=c.keepInBounds(this._options.snapStep,0,this._options.stepVal||0),this._currentZoom=this._setZoom(this._options.zoom,this._options.zoomMin,this._options.zoomMax),this._options.min=c.isNumber(this._options.min)?this._options.min:0,this._options.max=c.isNumber(this._options.max)?this._options.max:Number.MAX_VALUE,this._applyContainersStyles(),!1===e.timelineInteractive&&this._drag&&this._drag.type===$.Timeline&&this._cleanUpSelection(),this._options):this._options}},{key:"getModel",value:function(){return this._model}},{key:"setModel",value:function(e){this._model=e,this.rescale(),this.redraw()}},{key:"_getMousePos",value:function(e,t){var n=1,i=0,o=0;if(t.changedTouches&&t.changedTouches.length>0){var r=t.changedTouches[0];i=r.clientX,o=r.clientY,n=Math.max(n,r.radiusX,r.radiusY)}else i=t.clientX,o=t.clientY;var l=e.getBoundingClientRect(),a=e.width/this._pixelRatio/l.width,s=e.height/this._pixelRatio/l.height;return{x:(i-l.left)*a,y:(o-l.top)*s,radius:n,args:t}}},{key:"_updateCanvasScale",value:function(){if(this._scrollContainer&&this._container&&this._ctx){var e=!1,t=this._scrollContainer.clientWidth*this._pixelRatio,n=this._scrollContainer.clientHeight*this._pixelRatio;return Math.floor(t)!=Math.floor(this._ctx.canvas.width)&&(this._ctx.canvas.width=t,e=!0),Math.floor(n)!=Math.floor(this._ctx.canvas.height)&&(this._ctx.canvas.height=n,e=!0),e&&this._ctx.setTransform(this._pixelRatio,0,0,this._pixelRatio,0,0),e}console.log("Component should be initialized first")}},{key:"rescale",value:function(){return this._rescaleInternal()}},{key:"_rescaleInternal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:re.DefaultMode,i=this._updateCanvasScale(),o=this._calculateModel();if(o&&o.size){var r=this._options.stepPx;e=e||0;var l=this.valToPx(this._val)+this._leftMargin(),a=0,s=this.getScrollLeft()+this.getClientWidth();l>=s&&(a=n==re.ScrollBySelection?Math.floor(l+this._leftMargin()):Math.floor(l+this.getClientWidth()+this._leftMargin()));var c=o.size.width+this._leftMargin()+r;e=Math.max(e,c,s,a);var u=Math.floor(e)+"px";u!=this._scrollContent.style.minWidth&&(this._scrollContent.style.minWidth=u,i=!0),t=Math.max(Math.floor(o.size.height+.2*this._height()),this._scrollContainer.scrollTop+this._height()-1,Math.round(t||0));var h=Math.floor(t)+"px";if(this._scrollContent.style.minHeight!=h)return this._scrollContent.style.minHeight=h,i}return i}},{key:"_filterDraggableElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=function(e){return e===$.Timeline?1:e===$.Keyframe?2:e===$.Group?3:-1},o=e.filter((function(e){if(!e)return!1;if(e.type===$.Keyframe){if(!l.keyframeDraggable(e.keyframe,e.row,t._options))return!1}else if(e.type===$.Group){if(!l.groupDraggable(e.row,t._options))return!1}else if(e.type===$.Timeline){var n;if(!1===(null===(n=t._options)||void 0===n?void 0:n.timelineInteractive))return!1}else if(e.type===$.Row)return!1;return!0})),r=function(e,t){var o=i(e.type),r=i(t.type);return o!==r||null!==n&&(o=c.getDistance(e.val,n))!==(r=c.getDistance(t.val,n))?o<r?1:-1:0},a=o.sort(r);return a.length>0?a[a.length-1]:null}},{key:"elementFromPoint",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2?arguments[2]:void 0;n=Math.max(n,1);var o=[];if(!e)return o;var r=l.headerHeight(this._options),a=this._toScreenPx(this._val),s=0;if(this._options&&this._options.timelineStyle){var u=this._options.timelineStyle;s=Math.max((u.width||1)*this._pixelRatio,(u.capWidth||0)*this._pixelRatio||1)+n}(e.y<=.5*r||e.x>=a-s/2&&e.x<=a+s/2)&&o.push({val:this._val,type:$.Timeline});var h=this._options.snapEnabled;return e.y>=r&&this._options.keyframesDraggable&&this._forEachKeyframe((function(i,r,l){if(l){if(c.isOverlap(e.x,e.y,i.parentRow.size)){var a={val:t._mousePosToVal(e.x,h),keyframes:i.parentRow.model.keyframes,type:$.Row,row:i.parentRow.model};o.push(a)}i.parentRow.groups&&i.parentRow.groups.forEach((function(n){if(c.isOverlap(e.x,e.y,n.size)){var r=t._mapKeyframes(n.keyframes),l={val:t._mousePosToVal(e.x,h),type:$.Group,group:n,row:i.parentRow.model,keyframes:r},a=t.snapVal(n.min);l.val+=n.min-a,o.push(l)}}))}var s=i.size;s&&c.getDistance(s.x,s.y,e.x,e.y)<=s.height+n&&o.push({keyframe:i.model,keyframes:[i.model],val:i.model.val,row:i.parentRow.model,type:$.Keyframe})})),i&&0!==i.length?o.filter((function(e){return i&&i.includes(e.type)})):o}},{key:"_cloneOptions",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"_mergeOptions",value:function(e,t){t=t||{};var n=this._cloneOptions(e);return function e(t,n){if(t&&n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&void 0!==n[i]&&("object"===he(n[i])&&t[i]?e(t[i],n[i]):t[i]=n[i])}(n,t),n}},{key:"onTimeChanged",value:function(e){this.on(ie.TimeChanged,e)}},{key:"onDragStarted",value:function(e){this.on(ie.DragStarted,e)}},{key:"onDrag",value:function(e){this.on(ie.Drag,e)}},{key:"onDragFinished",value:function(e){this.on(ie.DragFinished,e)}},{key:"onDoubleClick",value:function(e){this.on(ie.DoubleClick,e)}},{key:"onKeyframeChanged",value:function(e){this.on(ie.KeyframeChanged,e)}},{key:"onMouseDown",value:function(e){this.on(ie.MouseDown,e)}},{key:"onSelected",value:function(e){this.on(ie.Selected,e)}},{key:"onScroll",value:function(e){this.on(ie.Scroll,e)}},{key:"onScrollFinished",value:function(e){this.on(ie.ScrollFinished,e)}},{key:"_emitScrollEvent",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie.Scroll,i={args:e,scrollProgrammatically:t,scrollLeft:this.getScrollLeft(),scrollTop:this.getScrollTop(),scrollHeight:this._scrollContainer.scrollHeight,scrollWidth:this._scrollContainer.scrollWidth};return ye(ge(s.prototype),"emit",this).call(this,n,i),i}},{key:"_emitKeyframeChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.Programmatically,n=new b;return n.val=e.val,n.prevVal=e.prevVal,n.target=e,n.source=t,this.emit(ie.KeyframeChanged,n),n}},{key:"_emitDragStartedEvent",value:function(){var e=this._getDragEventArgs();return this.emit(ie.DragStarted,e),e.isPrevented()&&this._preventDrag(e,this._drag,!0),e}},{key:"_emitDragFinishedEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._drag&&this._drag.changed){var t=this._getDragEventArgs();return e&&t.preventDefault(),this.emit(ie.DragFinished,t),t.isPrevented()&&this._preventDrag(t,this._drag,!0),t}return null}},{key:"_preventDrag",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.elements&&e.elements.forEach((function(e){var t=i?e.startedVal:e.prevVal;n._setKeyframePos(e,t)})),t.val=t.prevVal,e.val=e.prevVal}},{key:"_emitDragEvent",value:function(){if(!this._drag)return null;var e=this._getDragEventArgs();return this.emit(ie.Drag,e),e.isPrevented()&&this._preventDrag(e,this._drag,!1),e}},{key:"_emitKeyframesSelected",value:function(e){var t=new j;return t.selected=e.selected,t.changed=e.changed,this.emit(ie.Selected,t),t}},{key:"_getDragEventArgs",value:function(){var e=new oe;return this._currentPos&&(e.val=this._currentPos.val,e.originalVal=this._currentPos.originalVal,e.snapVal=this._currentPos.snapVal,e.pos=this._currentPos),this._drag?(e.elements=this._drag.elements,e.target=this._drag.target):(e.elements=[],e.target=null),e}}],n&&_e(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o);return t})()));